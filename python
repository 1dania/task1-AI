import tensorflow as tf
import numpy as np
from PIL import Image
import sys

# تحميل النموذج
model = tf.keras.models.load_model("keras_model.h5")

# تحميل الفئات
with open("labels.txt", "r") as f:
    labels = [line.strip() for line in f.readlines()]

# دالة لتحويل الصورة لمصفوفة جاهزة للنموذج
def prepare_image(image_path):
    img = Image.open(image_path).resize((224, 224))
    img_array = np.array(img).astype("float32") / 255.0
    img_array = np.expand_dims(img_array, axis=0)
    return img_array

# مسار الصورة من سطر الأوامر
if len(sys.argv) < 2:
    print("يرجى تحديد مسار الصورة: python predict_image.py image.jpg")
    exit()

image_path = sys.argv[1]
input_image = prepare_image(image_path)

# التنبؤ
prediction = model.predict(input_image)[0]
predicted_index = np.argmax(prediction)
predicted_label = labels[predicted_index]

print(f"✔️ التنبؤ: {predicted_label} (النسبة: {prediction[predicted_index]*100:.2f}%)")
